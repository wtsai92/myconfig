#DNS分流部分
mixed-port: 7890
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
external-controller: '127.0.0.1:9090'
dns:
    enable: true
    ipv6: false
    prefer-h3: true
    default-nameserver: [223.5.5.5, 119.29.29.29]
    enhanced-mode: fake-ip
    fake-ip-range: 198.18.0.1/16
    use-hosts: true
    nameserver: ['https://doh.pub/dns-query', 'https://208.67.222.222/dns-query']
    proxy-server-nameserver: ['https://doh.pub/dns-query']
    fallback: ['https://1.1.1.1/dns-query', 'tls://1.1.1.1:853', 'https://1.1.1.3/dns-query', 'tls://1.1.1.3:853', 'https://208.67.222.222/dns-query', 'https://208.67.220.220/dns-query']
    fallback-filter: { geoip: false, ipcidr: [240.0.0.0/4, 0.0.0.0/32, 61.160.148.90/32, '3131:3131:3131:3131:3131:3131:3131:3131/128'], domain: [+.fmta.boo] }

#订阅节点（自建节点和机场节点引用），更新订阅可以在clash UI代理下的代理集合手动更新
#输入自己的订阅名称和订阅对应的存储在本地名字，ulr后输入订阅地址（别忘了修改第二部分策略组对应引用的订阅名称）
#可用正则剔除高倍节点和一些乱七八糟的节点（比如什么机场网址、套餐到期时间什么的）
proxy-providers:
  订阅A:
    type: http
    path: ./profiles/proxies/订阅A.yaml
    url: 输入订阅链接地址
    health-check:
      enable: true
      url: https://www.google.com/generate_204
      interval: 300
#  filter: 此处可以按需根据正则筛选节点

  订阅B:
    type: http
    path: ./profiles/proxies/订阅B.yaml
    url: 输入订阅链接地址
    health-check:
      enable: true
      url: https://www.google.com/generate_204
      interval: 300



#策略组
#我常用的AI、电报、YouTube分流对应的策略，香港、日本、新加坡、美国  按地区策略组
proxy-groups:
#PROXY为默认代理组，香港、日本、新加坡节点组负载均衡
  - name: PROXY
    type: fallback
    proxies:
      - 香港
      - 日本
      - 新加坡
      
#AI的分流都走这个，我一般选美国节点
  - name: AI
    type: select
    proxies:
      - 美国
      - 新加坡

  - name: 电报
    type: select
    proxies:
      - PROXY
      - 香港
      - 新加坡

  - name: Youtube
    type: select
    proxies:
      - PROXY
      - 香港
      - 新加坡
      - 日本
      - 美国

  - name: Google
    type: select
    proxies:
      - PROXY
      - 香港
      - 美国

  - name: 微软
    type: select
    proxies:
      - PROXY
      - 香港
      - 美国

#香港、日本、新加坡、美国  节点按地区策略分组，地区节点组按延迟自动选择
  - name: 香港
    type: url-test
    url: https://www.google.com/generate_204
    interval: 300
    lazy: true
    timeout: 5000
    max-failed-times: 5
    tolerance: 30
    use:
      - 订阅A
      - 订阅B
    filter: 香港|HK|Hong Kong

  - name: 日本
    type: url-test
    url: https://www.google.com/generate_204
    interval: 300
    lazy: true
    timeout: 5000
    max-failed-times: 5
    tolerance: 30
    use:
      - 订阅A
      - 订阅B
    filter: 日本|JP|Japan

  - name: 新加坡
    type: url-test
    url: https://www.google.com/generate_204
    interval: 300
    lazy: true
    timeout: 5000
    max-failed-times: 5
    tolerance: 30
    use:
      - 订阅A
      - 订阅B
    filter: 新加坡|狮城|SG|Singapore

  - name: 美国
    type: url-test
    url: https://www.google.com/generate_204
    interval: 300
    lazy: true
    timeout: 5000
    max-failed-times: 5
    tolerance: 30
    use:
      - 订阅A
      - 订阅B
    filter: 美国|US|United States

#兜底策略组
  - name: 终则
    type: select
    proxies:
      - PROXY
      - DIRECT


#规则集
rule-providers:
  reject:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt
    path: ./ruleset/reject.yaml
    interval: 86400
  youtube:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml
    path: ./ruleset/youtube.yaml
    interval: 86400

  OpenAI:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OpenAI/OpenAI.yaml
    path: ./ruleset/OpenAI.yaml
    interval: 86400
  Claude:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Claude/Claude.yaml
    path: ./ruleset/Claude.yaml
    interval: 86400
  gemini:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml
    path: ./ruleset/gemini.yaml
    interval: 86400
  icloud:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt
    path: ./ruleset/icloud.yaml
    interval: 86400
  apple:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt
    path: ./ruleset/apple.yaml
    interval: 86400
  microsoft:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml
    path: ./ruleset/microsoft.yaml
    interval: 86400
  google:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt
    path: ./ruleset/google.yaml
    interval: 86400
  proxy:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt
    path: ./ruleset/proxy.yaml
    interval: 86400
  direct:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt
    path: ./ruleset/direct.yaml
    interval: 86400
  private:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt
    path: ./ruleset/private.yaml
    interval: 86400
  gfw:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt
    path: ./ruleset/gfw.yaml
    interval: 86400
  tld-not-cn:
    type: http
    behavior: domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt
    path: ./ruleset/tld-not-cn.yaml
    interval: 86400
  telegramcidr:
    type: http
    behavior: ipcidr
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt
    path: ./ruleset/telegramcidr.yaml
    interval: 86400
  cncidr:
    type: http
    behavior: ipcidr
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt
    path: ./ruleset/cncidr.yaml
    interval: 86400
  lancidr:
    type: http
    behavior: ipcidr
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt
    path: ./ruleset/lancidr.yaml
    interval: 86400
  applications:
    type: http
    behavior: classical
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt
    path: ./ruleset/applications.yaml
    interval: 86400

#指定分流规则所使用的策略组
rules:
#AI分流,补充的一些
  - DOMAIN-SUFFIX,perplexity.ai,AI
  - DOMAIN,aistudio.google.com,AI
  - DOMAIN-SUFFIX,spark.ai,AI

#steam下载分流
  - DOMAIN,steamcdn-a.akamaihd.net,DIRECT
  - DOMAIN-SUFFIX,steamserver.net,DIRECT
  - DOMAIN,lancache.steamcontent.com,DIRECT

#规则集指定策略组
  - RULE-SET,applications,DIRECT
  - DOMAIN,clash.razord.top,DIRECT
  - DOMAIN,yacd.haishan.me,DIRECT
  - RULE-SET,private,DIRECT
  - RULE-SET,reject,REJECT
  - RULE-SET,youtube,Youtube
  - RULE-SET,microsoft,微软
  - RULE-SET,OpenAI,AI
  - RULE-SET,Claude,AI
  - RULE-SET,gemini,AI
  - RULE-SET,icloud,DIRECT
  - RULE-SET,apple,DIRECT
  - RULE-SET,google,Google
  - RULE-SET,proxy,PROXY
  - RULE-SET,direct,DIRECT
  - RULE-SET,lancidr,DIRECT
  - RULE-SET,cncidr,DIRECT
  - RULE-SET,telegramcidr,电报
  - RULE-SET,tld-not-cn,PROXY
  - RULE-SET,gfw,PROXY
  - GEOIP,LAN,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,终则
